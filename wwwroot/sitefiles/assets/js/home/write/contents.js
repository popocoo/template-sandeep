var $url="/write/contents",$defaultWidth=160,data=utils.init({pageType:null,sites:null,siteName:null,siteUrl:null,root:null,allCheckedLevels:[],checkedLevels:[],pageContents:null,total:null,pageSize:null,page:1,columns:null,permissions:null,menus:null,tableMaxHeight:999999999999,multipleSelection:[],checkedColumns:[],siteId:0,channelId:null}),methods={apiTree:function(){var t=this;$api.post($url+"/actions/tree",{siteId:this.siteId,reload:!1}).then(function(e){var n=e.data;if(!n.siteId)return t.pageType="Unauthorized",void utils.loading(t,!1);t.sites=n.sites,t.siteId=n.siteId,t.siteName=n.siteName,t.siteUrl=n.siteUrl,t.root=n.root,t.columns=n.columns,t.permissions=n.permissions,t.allCheckedLevels=n.checkedLevels,t.checkedLevels=_.map(n.checkedLevels,function(t){return t.label}),t.apiList(t.siteId,1)}).catch(function(e){utils.loading(t,!1),utils.error(e)})},apiList:function(t,e,n){var i=this;utils.loading(this,!0),$api.post($url+"/actions/list",{siteId:this.siteId,channelId:this.channelId,page:e,isCheckedLevels:this.isCheckedLevels,checkedLevels:this.checkedLevels}).then(function(t){var l=t.data;i.pageContents=l.pageContents,i.total=l.total,i.pageSize=l.pageSize,i.page=e,n&&utils.success(n)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1),i.scrollToTop()})},apiColumns:function(t){$api.post($url+"/actions/columns",{siteId:this.siteId,attributeNames:t}).then(function(t){t.data}).catch(function(t){utils.error(t)})},getContentUrl:function(t){return utils.getRootUrl("redirect",{siteId:t.siteId,channelId:t.channelId,contentId:t.id})},btnTitleClick:function(t){if(t.checked&&t.channelId>0)return!1;utils.openLayer({title:"查看内容",url:utils.getCmsUrl("contentsLayerView",{siteId:this.siteId,channelId:Math.abs(t.channelId),contentId:t.id}),full:!0})},btnEditClick:function(t){utils.addTab("编辑内容",this.getEditUrl(t))},btnAdminClick:function(t){utils.openLayer({title:"管理员查看",url:utils.getCommonUrl("adminLayerView",{adminId:t}),width:550,height:450})},getAddUrl:function(){return utils.getRootUrl("write/editor",{siteId:this.siteId,channelId:this.channelId,page:this.page,tabName:utils.getTabName()})},getEditUrl:function(t){return utils.getRootUrl("write/editor",{siteId:this.siteId,channelId:t.channelId,contentId:t.id,page:this.page})},btnAddClick:function(){utils.addTab("添加内容",this.getAddUrl())},btnImportClick:function(t){"Word"===t?this.btnLayerClick({title:"批量导入Word",name:"Word",full:!0}):"Import"===t&&this.btnLayerClick({title:"批量导入",name:"Import",full:!0})},btnMoreClick:function(t){"Group"===t?this.btnLayerClick({title:"批量设置分组",name:"Group",width:700,height:400,withContents:!0}):"Tag"===t?this.btnLayerClick({title:"批量设置标签",name:"Tag",width:700,height:400,withContents:!0}):"Copy"===t?this.btnLayerClick({title:"批量复制",name:"Copy",withContents:!0}):"ExportAll"===t?this.btnLayerClick({title:"导出全部",name:"Export",full:!0}):"ExportSelected"===t?this.btnLayerClick({title:"导出选中",name:"Export",full:!0,withContents:!0}):"Arrange"===t?this.btnLayerClick({title:"整理排序",name:"Arrange",width:550,height:350}):"Hits"===t&&this.btnLayerClick({title:"设置点击量",name:"Hits",width:450,height:320,withContents:!0})},btnCreateClick:function(){var t=this;this.isContentChecked&&(utils.loading(this,!0),$api.post($url+"/actions/create",{siteId:t.siteId,channelContentIds:this.channelContentIdsString}).then(function(e){e.data;utils.addTab("生成进度查看",utils.getCmsUrl("createStatus",{siteId:t.siteId}))}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)}))},btnLayerClick:function(t){var e={siteId:this.siteId,page:this.page};if(t.channelId?e.channelId=t.channelId:e.channelId=this.siteId,t.contentId&&(e.contentId=t.contentId),t.withContents){if(!this.isContentChecked)return;e.channelContentIds=this.channelContentIdsString}t.url=utils.getCmsUrl("contentsLayer"+t.name,e),utils.openLayer(t)},btnContentViewClick:function(t){utils.openLayer({title:"查看内容",url:utils.getCmsUrl("contentsLayerView",{siteId:this.siteId,channelId:this.siteId,contentId:t}),full:!0})},btnContentStateClick:function(t){utils.openLayer({title:"查看审核状态",url:utils.getCmsUrl("contentsLayerState",{siteId:this.siteId,channelId:this.siteId,contentId:t}),full:!0})},scrollToTop:function(){document.documentElement.scrollTop=document.body.scrollTop=0},tableRowClassName:function(t){return-1!==this.multipleSelection.indexOf(t.row)?"current-row":""},handleSelectionChange:function(t){this.multipleSelection=t},toggleSelection:function(t){this.$refs.multipleTable.toggleRowSelection(t)},handleCurrentChange:function(t){this.apiList(this.siteId,t)},handleColumnsChange:function(){var t=_.filter(this.columns,function(t){return t.isList}),e=_.map(t,function(t){return t.attributeName});this.apiColumns(e)},getColumnWidth:function(t){return"Sequence"===t.attributeName||"Id"===t.attributeName||"Hits"===t.attributeName||"HitsByDay"===t.attributeName||"HitsByWeek"===t.attributeName||"HitsByMonth"===t.attributeName||"Downloads"===t.attributeName?70:"ImageUrl"===t.attributeName?100:"Guid"===t.attributeName||"SourceId"===t.attributeName?310:"Title"===t.attributeName?"":$defaultWidth},getColumnMinWidth:function(t){return"Title"===t.attributeName?400:""}},$vue=new Vue({el:"#main",data:data,methods:methods,computed:{isCheckedLevels:function(){return this.checkedLevels.length!=this.checkedLevels.length},isContentChecked:function(){return this.multipleSelection.length>0},channelContentIds:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push({channelId:n.channelId,id:n.id})}return t},channelContentIdsString:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push(n.channelId+"_"+n.id)}return t.join(",")}},created:function(){this.apiTree()}});