var $url="/write/editor",data=utils.init({siteId:utils.getQueryInt("siteId"),channelId:utils.getQueryInt("channelId"),contentId:utils.getQueryInt("contentId"),page:utils.getQueryInt("page"),tabName:utils.getQueryString("tabName"),mainHeight:"",sideType:"first",collapseSettings:["checkedLevel","addDate"],collapseMore:["translations"],site:null,siteUrl:null,channel:null,groupNames:null,tagNames:null,checkedLevels:null,siteOptions:null,channelOptions:null,styles:null,form:null,translations:[],isPreviewSaving:!1}),methods={insertEditor:function(t,e){e&&UE.getEditor(t,{allowDivTransToP:!1,maximumWords:99999999}).execCommand("insertHTML",e)},insertText:function(t,e,i){var n=this.form[utils.getCountName(t)];n&&n<e&&(this.form[utils.getCountName(t)]=e),this.form[utils.getExtendName(t,e)]=i,this.form=_.assign({},this.form)},addTranslation:function(t,e,i,n){this.translations.push({transSiteId:t,transChannelId:e,transType:i,name:n})},updateGroups:function(t,e){this.groupNames=t.groupNames,utils.success(e)},apiGet:function(){var t=this;window.onresize=t.winResize,window.onresize(),$api.get($url,{params:{siteId:t.siteId,channelId:t.channelId,contentId:t.contentId}}).then(function(e){var i=e.data;t.loadEditor(i)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiInsert:function(){var t=this;utils.loading(this,!0),$api.post($url,{siteId:this.siteId,channelId:this.channelId,contentId:this.contentId,content:this.form,translations:this.translations}).then(function(e){e.data;t.closeAndRedirect()}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiUpdate:function(){var t=this;utils.loading(this,!0),$api.put($url,{siteId:this.siteId,channelId:this.channelId,contentId:this.contentId,content:this.form,translations:this.translations}).then(function(e){e.data;t.closeAndRedirect()}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},closeAndRedirect:function(t){var e=utils.getTabVue(this.tabName);e&&(t?e.apiList(this.channelId,this.page,"内容保存成功！"):e.apiList(this.channelId,this.page,"内容保存成功！",!0)),utils.removeTab(),utils.openTab(this.tabName)},loadEditor:function(t){this.site=t.site,this.siteUrl=t.siteUrl,this.channel=t.channel,this.groupNames=t.groupNames,this.tagNames=t.tagNames,this.checkedLevels=t.checkedLevels,this.siteOptions=t.siteOptions,this.channelOptions=t.channelOptions,this.styles=t.styles,this.form=_.assign({},t.content),this.form.checked&&(this.form.checkedLevel=this.site.checkContentLevel),(this.form.top||this.form.recommend||this.form.hot||this.form.color)&&this.collapseSettings.push("attributes"),this.form.groupNames&&this.form.groupNames.length>0?this.collapseSettings.push("groupNames"):this.form.groupNames=[],this.form.tagNames&&this.form.tagNames.length>0?this.collapseSettings.push("tagNames"):this.form.tagNames=[],this.form.linkUrl&&this.collapseSettings.push("linkUrl");for(var e=0;e<this.styles.length;e++){var i=this.styles[e];if("Image"===i.inputType||"File"===i.inputType||"Video"===i.inputType)this.form[utils.getCountName(i.attributeName)]||(this.form[utils.getCountName(i.attributeName)]=0)}var n=this;setTimeout(function(){for(var t=0;t<n.styles.length;t++){var e=n.styles[t];if("TextEditor"===e.inputType){var i=UE.getEditor(e.attributeName,{allowDivTransToP:!1,maximumWords:99999999});i.styleIndex=t,i.ready(function(){i.addListener("contentChange",function(){var t=n.styles[this.styleIndex];n.form[t.attributeName]=this.getContent()})})}}},100)},winResize:function(){this.mainHeight=$(window).height()-52+"px"},btnLayerClick:function(t){var e={siteId:this.siteId,channelId:this.channelId};t.attributeName&&(e.attributeName=t.attributeName),t.contentId&&(e.contentId=t.contentId),t.no&&(e.no=t.no),utils.openLayer({title:t.title,url:utils.getCommonUrl(t.name,e),full:t.full,width:t.width?t.width:700,height:t.height?t.height:500})},handleTranslationClose:function(t){this.translations=_.remove(this.translations,function(e){return t!==e.name})},btnSaveClick:function(){UE&&$.each(UE.instants,function(t,e){e.sync()}),0===this.contentId?this.apiInsert():this.apiUpdate()},btnGroupAddClick:function(){utils.openLayer({title:"新增内容组",url:utils.getCommonUrl("groupContentLayerAdd",{siteId:this.siteId}),width:500,height:300})},btnTranslateAddClick:function(){utils.openLayer({title:"选择转移栏目",url:utils.getCmsUrl("editorLayerTranslate",{siteId:this.siteId,channelId:this.channelId}),width:550,height:400})},btnPreviewClick:function(){if(this.styles[0].value&&!this.isPreviewSaving){UE&&$.each(UE.instants,function(t,e){e.sync()});var t=this;utils.loading(this,!0),$api.post($url+"/actions/preview",{siteId:this.siteId,channelId:this.channelId,contentId:this.contentId,content:this.form}).then(function(e){var i=e.data;t.isPreviewSaving=!1,window.open(i.url)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})}},btnExtendAddClick:function(t){var e=this.form[utils.getCountName(t.attributeName)]+1;this.form[utils.getCountName(t.attributeName)]=e,this.form[utils.getExtendName(t.attributeName,e)]="",this.form=_.assign({},this.form)},btnExtendRemoveClick:function(t){var e=this.form[utils.getCountName(t.attributeName)];this.form[utils.getCountName(t.attributeName)]=e-1,this.form[utils.getExtendName(t.attributeName,e)]="",this.form=_.assign({},this.form)},btnExtendPreviewClick:function(t,e){for(var i=this.form[utils.getCountName(t.attributeName)],n=[],s=0;s<=i;s++){var a=this.form[utils.getExtendName(t.attributeName,s)];a=utils.getUrl(this.siteUrl,a),n.push({src:a})}layer.photos({photos:{start:e,data:n},anim:5})}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){this.apiGet()}});