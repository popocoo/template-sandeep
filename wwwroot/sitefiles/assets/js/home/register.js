var $url="/register",$urlCaptcha="/register/captcha",$urlCaptchaCheck="/register/captcha/actions/check",data=utils.init({returnUrl:decodeURIComponent(utils.getQueryString("returnUrl")),isUserRegistrationGroup:null,isHomeAgreement:null,homeAgreementHtml:null,styles:null,groups:null,isAgreement:!1,captchaToken:null,captchaUrl:null,form:null}),methods={insertText:function(t,e,a){this.form[utils.getCountName(t)]<e&&(this.form[utils.getCountName(t)]=e),this.form[utils.getExtendName(t,e)]=a,this.form=_.assign({},this.form)},apiGet:function(){var t=this;utils.loading(this,!0),$api.get($url).then(function(e){var a=e.data;t.form={captchaValue:"",groupId:0},t.isUserRegistrationGroup=a.isUserRegistrationGroup,t.isHomeAgreement=a.isHomeAgreement,t.homeAgreementHtml=a.homeAgreementHtml,t.styles=a.styles;for(var i=0;i<a.styles.length;i++){var r=a.styles[i];t.form[_.lowerFirst(r.attributeName)]=r.defaultValue}t.form=_.assign({},t.form),t.groups=a.groups,t.apiCaptchaReload()}).catch(function(t){utils.error(t,{redirect:!0})}).then(function(){utils.loading(t,!1)})},btnExtendAddClick:function(t){var e=this.form[utils.getCountName(t.attributeName)]+1;this.form[utils.getCountName(t.attributeName)]=e,this.form[utils.getExtendName(t.attributeName,e)]=""},btnExtendRemoveClick:function(t){var e=this.form[utils.getCountName(t.attributeName)]-1;this.form[utils.getCountName(t.attributeName)]=e,this.form[utils.getExtendName(t.attributeName,e)]=""},btnPreviewClick:function(t,e){var a=e?this.form[utils.getExtendName(t,e)]:this.form[t];window.open(a)},apiCaptchaReload:function(){var t=this;utils.loading(this,!0),$api.post($urlCaptcha).then(function(e){var a=e.data;t.captchaToken=a.value,t.form.captchaValue="",t.captchaUrl=$apiUrl+$urlCaptcha+"?token="+t.captchaToken}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiCheckCaptcha:function(){var t=this;utils.loading(this,!0),$api.post($urlCaptchaCheck,{token:this.captchaToken,value:this.form.captchaValue}).then(function(e){t.apiSubmit()}).catch(function(e){t.apiCaptchaReload(),utils.loading(t,!1),utils.error(e)})},apiSubmit:function(){var t=this;utils.loading(this,!0);var e=_.assign({},this.form);delete e.captchaValue,delete e.confirmPassword,$api.post($url,e).then(function(e){e.data.value?utils.alertSuccess({title:"恭喜，账号注册成功",button:"进入登录页",callback:function(){location.href=utils.getRootUrl("login",{returnUrl:t.returnUrl})}}):utils.alertSuccess({title:"账号注册成功，请等待管理员审核",button:"进入登录页",callback:function(){location.href=utils.getRootUrl("login",{returnUrl:t.returnUrl})}})}).catch(function(e){t.apiCaptchaReload(),utils.loading(t,!1),utils.error(e)})},btnRegisterClick:function(){var t=this;this.$refs.form.validate(function(e){e&&t.apiCheckCaptcha()})},btnLoginClick:function(){location.href=utils.getRootUrl("login")},validatePass:function(t,e,a){""===e?a(new Error("请再次输入密码")):e!==this.form.password?a(new Error("两次输入密码不一致!")):a()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){this.apiGet()}});