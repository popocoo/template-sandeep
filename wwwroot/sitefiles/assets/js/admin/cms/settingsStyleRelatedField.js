var $url="/cms/settings/settingsStyleRelatedField",$urlImport="/cms/settings/settingsStyleRelatedField/actions/import",$urlItems=$url+"/items",$urlItemsOrder=$urlItems+"/actions/order",data=utils.init({siteId:utils.getQueryInt("siteId"),urlUpload:null,relatedFields:null,editorPanel:!1,editorForm:null,itemsPanel:!1,itemsRelatedField:null,itemsParentId:0,itemsTree:null,itemsExpandedIds:[],itemsAddDialog:!1,itemsAddForm:null,itemsEditDialog:!1,itemsEditForm:null,uploadPanel:!1,uploadLoading:!1,uploadList:[]}),methods={apiList:function(t){var i=this;utils.loading(this,!0),$api.get($url,{params:{siteId:this.siteId}}).then(function(t){var e=t.data;i.relatedFields=e,i.urlUpload=$apiUrl+$urlImport+"?siteId="+i.siteId}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1),t&&utils.success(t)})},apiGetItems:function(t){var i=this;utils.loading(this,!0),$api.get($urlItems,{params:{siteId:this.siteId,relatedFieldId:t}}).then(function(t){var e=t.data;i.itemsTree=e.tree,i.itemsPanel=!0}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},apiDelete:function(t){var i=this;utils.loading(this,!0),$api.delete($url,{data:{siteId:this.siteId,relatedFieldId:t}}).then(function(t){var e=t.data;i.relatedFields=e,utils.success("联动字段删除成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},apiAdd:function(){var t=this;utils.loading(this,!0),$api.post($url,this.editorForm).then(function(i){var e=i.data;t.relatedFields=e,t.editorPanel=!1,utils.success("联动字段新增成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiEdit:function(){var t=this;utils.loading(this,!0),$api.put($url,this.editorForm).then(function(i){var e=i.data;t.relatedFields=e,t.editorPanel=!1,utils.success("联动字段编辑成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},btnDeleteClick:function(t,i){var e=this;utils.alertDelete({title:"删除联动字段",text:"此操作将删除联动字段 "+i+"，确定吗？",callback:function(){e.apiDelete(t)}})},btnCommandClick:function(t){"Add"===t?this.btnAddClick():"Import"===t?this.btnImportClick():"Export"===t&&this.btnExportClick()},btnCancelClick:function(){this.editorPanel=!1,this.itemsPanel=!1},btnAddClick:function(){this.editorForm={id:0,siteId:this.siteId,title:null},this.editorPanel=!0},btnEditClick:function(t){this.editorForm=_.assign({},t),this.editorPanel=!0},btnEditorSubmitClick:function(){var t=this;this.$refs.editorForm.validate(function(i){i&&(t.editorForm.id?t.apiEdit():t.apiAdd())})},btnItemsClick:function(t){this.itemsRelatedField=_.assign({},t),this.apiGetItems(t.id)},btnImportClick:function(){this.uploadPanel=!0},uploadBefore(t){var i=-1!==t.name.indexOf(".zip",t.name.length-".zip".length);return i||utils.error("样式导入文件只能是 Zip 格式!"),i},uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(t,i){this.uploadList=[],this.uploadPanel=!1,this.apiList("字段导入成功！")},uploadError:function(t){this.uploadList=[],utils.loading(this,!1);var i=JSON.parse(t.message);utils.error(i.message)},btnExportClick:function(){var t=this;utils.loading(this,!0),$api.post($url+"/actions/export",{siteId:this.siteId}).then(function(t){var i=t.data;window.open(i.value)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},btnItemsAddClick:function(t){this.itemsAddDialog=!0,this.itemsParentId=t,this.itemsAddForm={items:[{key:"",value:""}]}},btnItemRemoveClick:function(t){this.itemsAddForm.items.splice(t,1),0===this.itemsAddForm.items.length&&this.btnItemsAddClick()},btnItemAddClick:function(){this.itemsAddForm.items.push({label:"",value:""})},apiItemsDelete:function(t){var i=this;utils.loading(this,!0),$api.delete($urlItems,{data:{siteId:this.siteId,relatedFieldId:this.itemsRelatedField.id,id:t}}).then(function(t){var e=t.data;i.itemsTree=e.tree,utils.success("联动字段项删除成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},apiItemsAdd:function(){var t=this;utils.loading(this,!0),$api.post($urlItems,{siteId:this.siteId,relatedFieldId:this.itemsRelatedField.id,parentId:this.itemsParentId,items:this.itemsAddForm.items}).then(function(i){var e=i.data;t.itemsTree=e.tree,utils.success("联动字段项添加成功！"),t.itemsAddDialog=!1}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiItemsOrder:function(t,i){var e=this;utils.loading(this,!0),$api.post($urlItemsOrder,{siteId:this.siteId,relatedFieldId:this.itemsRelatedField.id,id:t,up:i}).then(function(t){var i=t.data;e.itemsTree=i.tree,utils.success("联动字段项排序成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},apiItemsEdit:function(){var t=this;utils.loading(this,!0),$api.put($urlItems,{siteId:this.siteId,relatedFieldId:this.itemsRelatedField.id,id:this.itemsEditForm.id,label:this.itemsEditForm.label,value:this.itemsEditForm.value}).then(function(i){var e=i.data;t.itemsTree=e.tree,utils.success("联动字段项编辑成功！"),t.itemsEditDialog=!1}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},btnItemsAddSubmitClick:function(){var t=this;this.$refs.itemsAddForm.validate(function(i){i&&t.apiItemsAdd()})},btnItemsAddCancelClick:function(){this.itemsAddDialog=!1},btnItemsDeleteClick:function(t,i){var e=this;utils.alertDelete({title:"删除联动字段",text:"此操作将删除联动字段项 "+t+"及其子项，确定吗？",callback:function(){e.apiItemsDelete(i)}})},btnItemsUpClick:function(t){this.apiItemsOrder(t.value,!0)},btnItemsDownClick:function(t){this.apiItemsOrder(t.value,!1)},btnItemsEditClick:function(t){this.itemsEditDialog=!0,this.itemsEditForm={id:t.value,label:t.label,value:t.itemValue}},btnItemsEditSubmitClick:function(){var t=this;this.$refs.itemsEditForm.validate(function(i){i&&t.apiItemsEdit()})},btnItemsEditCancelClick:function(){this.itemsEditDialog=!1}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){this.apiList()}});