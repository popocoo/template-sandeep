var $url="/cms/contents/contentsCheck",$defaultWidth=160,data=utils.init({siteId:utils.getQueryInt("siteId"),root:null,siteUrl:null,groupNames:null,tagNames:null,checkedLevels:[],pageContents:null,total:null,pageSize:null,page:1,columns:null,multipleSelection:[],checkedColumns:[],searchColumns:[],channelIds:[],searchForm:{startDate:null,endDate:null,checkedLevels:[],isTop:!1,isRecommend:!1,isHot:!1,isColor:!1,groupNames:[],tagNames:[]}}),methods={apiTree:function(){var t=this;$api.post($url+"/actions/tree",{siteId:this.siteId}).then(function(e){var n=e.data;t.root=n.root,t.siteUrl=n.siteUrl,t.groupNames=n.groupNames,t.tagNames=n.tagNames,t.checkedLevels=n.checkedLevels,t.columns=n.columns;var i=_.find(t.columns,function(t){return"Title"==t.attributeName});t.searchColumns.push({attributeName:i.attributeName,displayName:i.displayName,value:""}),t.searchForm.checkedLevels=_.map(n.checkedLevels,function(t){return t.label}),t.apiList(t.siteId,1)}).catch(function(e){utils.loading(t,!1),utils.error(e)})},apiList:function(t,e,n){for(var i=this,s=[],l=0;l<this.searchColumns.length;l++){var a=this.searchColumns[l];a.attributeName&&a.value&&s.push({key:a.attributeName,value:a.value})}var r=this.channelIds&&this.channelIds.length>0?this.channelIds[this.channelIds.length-1]:null;utils.loading(this,!0);var u=_.assign({siteId:this.siteId,isCheckedLevels:this.isCheckedLevels,channelId:r,page:e,items:s},this.searchForm);$api.post($url+"/actions/list",u).then(function(t){var s=t.data;i.pageContents=s.pageContents,i.total=s.total,i.pageSize=s.pageSize,i.page=e,n&&utils.success(n)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1),i.scrollToTop()})},apiColumns:function(t){$api.post($url+"/actions/columns",{siteId:this.siteId,attributeNames:t}).then(function(t){t.data}).catch(function(t){utils.error(t)})},btnSelectColumnClick:function(t){var e=_.find(this.searchColumns,function(e){return e.attributeName==t.attributeName});e?this.searchColumns.splice(this.searchColumns.indexOf(e),1):this.searchColumns.push({attributeName:t.attributeName,displayName:t.displayName,value:""})},getColumnEffect:function(t){return _.find(this.searchColumns,function(e){return e.attributeName==t.attributeName})?"dark":"plain"},getContentUrl:function(t){return utils.getRootUrl("redirect",{siteId:t.siteId,channelId:t.channelId,contentId:t.id})},btnTitleClick:function(t){if(t.checked&&t.channelId>0)return!1;utils.openLayer({title:"查看内容",url:utils.getCmsUrl("contentsLayerView",{siteId:this.siteId,channelId:Math.abs(t.channelId),contentId:t.id}),full:!0})},btnSearchClick:function(){var t=this;this.$refs.searchForm.validate(function(e){e&&t.apiList(t.siteId,1)})},btnEditClick:function(t){utils.openLayer({title:"编辑内容",url:this.getEditUrl(t),full:!0,max:!0})},btnAdminClick:function(t){utils.openLayer({title:"管理员查看",url:utils.getCommonUrl("adminLayerView",{adminId:t}),width:550,height:450})},getEditUrl:function(t){return utils.getCmsUrl("editor",{siteId:this.siteId,channelId:t.channelId,contentId:t.id,page:this.page})},btnLayerClick:function(t){var e={siteId:this.siteId,page:this.page};if(t.channelId?e.channelId=t.channelId:e.channelId=this.siteId,t.contentId&&(e.contentId=t.contentId),t.withContents){if(!this.isContentChecked)return;e.channelContentIds=this.channelContentIdsString}t.url=utils.getCmsUrl("contentsLayer"+t.name,e),utils.openLayer(t)},btnContentViewClick:function(t){utils.openLayer({title:"查看内容",url:utils.getCmsUrl("contentsLayerView",{siteId:this.siteId,channelId:this.siteId,contentId:t}),full:!0})},btnContentStateClick:function(t){utils.openLayer({title:"查看审核状态",url:utils.getCmsUrl("contentsLayerState",{siteId:this.siteId,channelId:this.siteId,contentId:t}),full:!0})},scrollToTop:function(){document.documentElement.scrollTop=document.body.scrollTop=0},tableRowClassName:function(t){return-1!==this.multipleSelection.indexOf(t.row)?"current-row":""},handleSelectionChange:function(t){this.multipleSelection=t},toggleSelection:function(t){this.$refs.multipleTable.toggleRowSelection(t)},handleCurrentChange:function(t){this.apiList(this.siteId,t)},handleColumnsChange:function(){var t=_.filter(this.columns,function(t){return t.isList}),e=_.map(t,function(t){return t.attributeName});this.apiColumns(e)},getColumnWidth:function(t){return"Sequence"===t.attributeName||"Id"===t.attributeName||"Hits"===t.attributeName||"HitsByDay"===t.attributeName||"HitsByWeek"===t.attributeName||"HitsByMonth"===t.attributeName||"Downloads"===t.attributeName?70:"ImageUrl"===t.attributeName?100:"Guid"===t.attributeName||"SourceId"===t.attributeName?310:"Title"===t.attributeName?"":$defaultWidth},getColumnMinWidth:function(t){return"Title"===t.attributeName?400:""},getUrl:function(t){return t?_.replace(t,"@/",this.siteUrl+"/"):""}},$vue=new Vue({el:"#main",data:data,methods:methods,computed:{isCheckedLevels:function(){return this.checkedLevels.length!==this.searchForm.checkedLevels.length},isFiltered:function(){return this.checkedLevels.length!==this.searchForm.checkedLevels.length||(!!(this.searchForm.isTop||this.searchForm.isRecommend||this.searchForm.isHot||this.searchForm.isColor)||(this.searchForm.groupNames.length>0||this.searchForm.tagNames.length>0))},isContentChecked:function(){return this.multipleSelection.length>0},channelContentIds:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push({channelId:n.channelId,id:n.id})}return t},channelContentIdsString:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push(n.channelId+"_"+n.id)}return t.join(",")}},created:function(){this.apiTree()}});