var $url="/cms/contents/contents",$defaultWidth=160,data=utils.init({siteId:utils.getQueryInt("siteId"),channelId:utils.getQueryInt("channelId")||utils.getQueryInt("siteId"),root:null,siteUrl:null,groupNames:null,tagNames:null,checkedLevels:[],expendedChannelIds:[],filterText:"",pageContents:null,total:null,pageSize:null,page:1,columns:null,permissions:null,menus:null,asideHeight:0,tableMaxHeight:0,multipleSelection:[],checkedColumns:[],searchForm:{searchType:"Title",searchText:"",isAllContents:!1},isAdvancedForm:!1,advancedForm:{checkedLevels:[],isTop:!1,isRecommend:!1,isHot:!1,isColor:!1,groupNames:[],tagNames:[]}}),methods={apiTree:function(t){var e=this;$api.post($url+"/actions/tree",{siteId:this.siteId,reload:t}).then(function(n){var i=n.data;e.root=[i.root],t?e.expendedChannelIds=[e.siteId,e.channelId]:(e.siteUrl=i.siteUrl,e.groupNames=i.groupNames,e.tagNames=i.tagNames,e.checkedLevels=i.checkedLevels,e.advancedForm.checkedLevels=_.map(i.checkedLevels,function(t){return t.label}),e.expendedChannelIds=[e.siteId])}).catch(function(t){utils.error(t)}).then(function(){e.asideHeight=$(window).height()-4,e.tableMaxHeight=$(window).height()-128,utils.loading(e,!1)})},apiList:function(t,e,n,i){var s=this;utils.loading(this,!0);var l=_.assign({siteId:this.siteId,channelId:t,page:e,searchType:this.searchForm.searchType,searchText:this.searchForm.searchText,isAdvanced:this.isAdvanced},this.advancedForm);$api.post($url+"/actions/list",l).then(function(l){var a=l.data;s.pageContents=a.pageContents,s.columns=a.columns,s.total=a.total,s.pageSize=a.pageSize,s.page=e,s.permissions=a.permissions,s.menus=a.menus,s.expendedChannelIds=[s.siteId,t],s.searchForm.isAllContents=a.isAllContents,n&&utils.success(n),i&&s.apiTree(!0)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(s,!1),s.scrollToTop()})},apiColumns:function(t){$api.post($url+"/actions/columns",{siteId:this.siteId,channelId:this.channelId,attributeNames:t}).then(function(t){t.data}).catch(function(t){utils.error(t)})},handleAllChange:function(){var t=this;utils.loading(this,!0),$api.post($url+"/actions/all",{siteId:this.siteId,channelId:this.channelId,isAllContents:this.searchForm.isAllContents}).then(function(e){e.data;t.apiList(t.channelId,1)}).catch(function(t){utils.error(t)})},getChannelUrl:function(t){return utils.getRootUrl("redirect",{siteId:this.siteId,channelId:t.value})},getContentUrl:function(t){return utils.getRootUrl("redirect",{siteId:t.siteId,channelId:t.channelId,contentId:t.id})},btnTitleClick:function(t){if(t.checked&&t.channelId>0)return!1;utils.openLayer({title:"查看内容",url:utils.getCmsUrl("contentsLayerView",{siteId:this.siteId,channelId:Math.abs(t.channelId),contentId:t.id}),full:!0})},btnSearchClick:function(){this.isAdvancedForm=!1,this.apiList(this.channelId,1)},handleTagNamesChange:function(t){t||(this.isAdvancedForm=!1,this.apiList(this.channelId,1))},btnAddClick:function(){utils.addTab("添加内容",this.getAddUrl())},btnImportClick:function(t){"Word"===t?this.btnLayerClick({title:"批量导入Word",name:"Word",full:!0}):"Import"===t&&this.btnLayerClick({title:"批量导入",name:"Import",full:!0})},btnMoreClick:function(t){"Group"===t?this.btnLayerClick({title:"批量设置分组",name:"Group",width:700,height:400,withContents:!0}):"Tag"===t?this.btnLayerClick({title:"批量设置标签",name:"Tag",width:700,height:400,withContents:!0}):"Copy"===t?this.btnLayerClick({title:"批量复制",name:"Copy",withContents:!0}):"ExportAll"===t?this.btnLayerClick({title:"导出全部",name:"Export",full:!0}):"ExportSelected"===t?this.btnLayerClick({title:"导出选中",name:"Export",full:!0,withContents:!0}):"Arrange"===t?this.btnLayerClick({title:"整理排序",name:"Arrange",width:550,height:350}):"Hits"===t&&this.btnLayerClick({title:"设置点击量",name:"Hits",width:450,height:320,withContents:!0})},btnEditClick:function(t){this.permissions.isEdit&&utils.addTab("编辑内容",this.getEditUrl(t))},btnAdminClick:function(t){utils.openLayer({title:"管理员查看",url:utils.getCommonUrl(adminLayerView,{adminId:t}),width:550,height:450})},getAddUrl:function(){return utils.getCmsUrl("editor",{siteId:this.siteId,channelId:this.channelId,page:this.page,tabName:utils.getTabName()})},getEditUrl:function(t){return utils.getCmsUrl("editor",{siteId:this.siteId,channelId:t.channelId,contentId:t.id,page:this.page,tabName:utils.getTabName()})},btnCreateClick:function(){var t=this;this.isContentChecked&&(utils.loading(this,!0),$api.post($url+"/actions/create",{siteId:t.siteId,channelContentIds:this.channelContentIdsString}).then(function(e){e.data;utils.addTab("生成进度查看",utils.getCmsUrl("createStatus",{siteId:t.siteId}))}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)}))},btnLayerClick:function(t){var e={siteId:this.siteId,page:this.page};if(t.channelId?e.channelId=t.channelId:e.channelId=this.channelId,t.contentId&&(e.contentId=t.contentId),t.withContents){if(!this.isContentChecked)return;e.channelContentIds=this.channelContentIdsString}t.url=utils.getCmsUrl("contentsLayer"+t.name,e),utils.openLayer(t)},btnContentViewClick:function(t){utils.openLayer({title:"查看内容",url:utils.getCmsUrl("contentsLayerView",{siteId:this.siteId,channelId:this.channelId,contentId:t}),full:!0})},btnContentStateClick:function(t){this.permissions.isEdit&&utils.openLayer({title:"查看审核状态",url:utils.getCmsUrl("contentsLayerState",{siteId:this.siteId,channelId:this.channelId,contentId:t}),full:!0})},btnMenuClick:function(t,e){if(this.permissions.isEdit){var n=utils.addQuery(t.link,{siteId:this.siteId,channelId:e.channelId,contentId:e.id});"_layer"==t.target?utils.openLayer({title:t.text,url:n,full:!0}):"_self"==t.target?location.href=n:"_parent"==t.target?parent.location.href=n:"_top"==t.target?top.location.href=n:"_blank"==t.target?window.open(n):utils.addTab(t.text,n)}},scrollToTop:function(){document.documentElement.scrollTop=document.body.scrollTop=0},tableRowClassName:function(t){return-1!==this.multipleSelection.indexOf(t.row)?"current-row":""},btnChannelClick:function(t){t.disabled||(this.channelId=t.value,this.apiList(t.value,1))},filterNode:function(t,e){return!t||(-1!==e.label.indexOf(t)||e.value+""===t)},handleSelectionChange:function(t){this.multipleSelection=t},toggleSelection:function(t){this.$refs.multipleTable.toggleRowSelection(t)},handleCurrentChange:function(t){this.apiList(this.channelId,t)},handleColumnsChange:function(){var t=_.filter(this.columns,function(t){return t.isList}),e=_.map(t,function(t){return t.attributeName});this.apiColumns(e)},getColumnWidth:function(t){return"string"==typeof t?30*t.length:"Sequence"===t.attributeName||"Id"===t.attributeName||"Hits"===t.attributeName||"HitsByDay"===t.attributeName||"HitsByWeek"===t.attributeName||"HitsByMonth"===t.attributeName||"Downloads"===t.attributeName?70:"ImageUrl"===t.attributeName?100:"Guid"===t.attributeName||"SourceId"===t.attributeName?310:"Title"===t.attributeName?"":$defaultWidth},getColumnMinWidth:function(t){return"Title"===t.attributeName?400:""}},$vue=new Vue({el:"#main",data:data,methods:methods,computed:{isAdvanced:function(){return this.checkedLevels.length!==this.advancedForm.checkedLevels.length||(!!(this.advancedForm.isTop||this.advancedForm.isRecommend||this.advancedForm.isHot||this.advancedForm.isColor)||(this.advancedForm.groupNames.length>0||this.advancedForm.tagNames.length>0))},isContentChecked:function(){return this.multipleSelection.length>0},channelContentIds:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push({channelId:n.channelId,id:n.id})}return t},channelContentIdsString:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push(n.channelId+"_"+n.id)}return t.join(",")}},watch:{filterText:function(t){this.$refs.tree.filter(t)}},created:function(){this.apiTree(!1)}});