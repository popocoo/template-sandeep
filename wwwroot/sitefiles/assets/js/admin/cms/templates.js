var $url="/cms/templates/templates",data=utils.init({siteId:utils.getQueryInt("siteId"),channels:null,allTemplates:null,templates:null,templateType:"All",channelIds:[],keyword:""}),methods={apiList:function(){var t=this;utils.loading(this,!0),$api.get($url,{params:{siteId:this.siteId}}).then(function(e){var a=e.data;t.channels=a.channels,t.allTemplates=t.templates=a.templates}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiDefault:function(t){var e=this;utils.loading(this,!0),$api.post($url+"/actions/default",{siteId:this.siteId,templateId:t.id}).then(function(t){var a=t.data;e.channels=a.channels,e.allTemplates=a.templates,e.reload(),utils.success("默认模板设置成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},apiDelete:function(t){var e=this;utils.loading(this,!0),$api.delete($url,{data:{siteId:this.siteId,templateId:t.id}}).then(function(t){var a=t.data;e.channels=a.channels,e.allTemplates=a.templates,e.reload(),utils.success("模板删除成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},tableRowClassName:t=>t.row.defaultTemplate?"default-row":"",getTemplateType:function(t){return"IndexPageTemplate"===t?"首页模板":"ChannelTemplate"===t?"栏目模板":"ContentTemplate"===t?"内容模板":"FileTemplate"===t?"单页模板":""},btnDefaultClick:function(t){var e=this;utils.alertWarning({title:"设置默认模板",text:"此操作将把模板 "+t.templateName+" 设为默认"+this.getTemplateType(t.templateType)+"，确认吗？",callback:function(){e.apiDefault(t)}})},btnCopyClick:function(t){var e=this;utils.loading(this,!0),$api.post($url+"/actions/copy",{siteId:this.siteId,templateId:t.id}).then(function(t){var a=t.data;e.channels=a.channels,e.allTemplates=a.templates,e.reload(),utils.success("快速复制成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},btnCreateClick:function(t){var e=this;utils.loading(this,!0),$api.post($url+"/actions/create",{siteId:this.siteId,templateId:t.id}).then(function(t){t.data;utils.addTab("生成进度查看",utils.getCmsUrl("createStatus",{siteId:e.siteId}))}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},btnDeleteClick:function(t){var e=this;utils.alertDelete({title:"删除模板",text:"此操作将删除模板 "+t.templateName+"，确认吗？",callback:function(){e.apiDelete(t)}})},getEditorUrl:function(t,e){return utils.getCmsUrl("templatesEditor",{siteId:this.siteId,templateId:e,templateType:t})},btnUserCountClick(t){"ChannelTemplate"==t.templateType?utils.addTab("匹配模板",utils.getCmsUrl("templatesMatch",{siteId:this.siteId,channelTemplateId:t.id})):"ContentTemplate"==t.templateType&&utils.addTab("匹配模板",utils.getCmsUrl("templatesMatch",{siteId:this.siteId,contentTemplateId:t.id}))},reload:function(){var t=this;this.templates=_.filter(this.allTemplates,function(e){var a=!0,l=!0,i=!0;if("All"!=t.templateType&&(a=e.templateType===t.templateType),t.channelIds.length>0){l=!1;for(var n=0;n<t.channelIds.length;n++){var s=t.channelIds[n][t.channelIds[n].length-1];e.channelIds&&-1!==e.channelIds.indexOf(s)&&(l=!0)}}return t.keyword&&(i=-1!==(e.templateName||"").indexOf(t.keyword)||-1!==(e.relatedFileName||"").indexOf(t.keyword)||-1!==(e.createdFileFullName||"").indexOf(t.keyword)),a&&l&&i})}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){this.apiList()}});