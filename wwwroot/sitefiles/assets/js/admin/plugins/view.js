var $url="/plugins/view",$urlActionsDisable=$url+"/actions/disable",$urlActionsDelete=$url+"/actions/delete",$urlActionsRestart=$url+"/actions/restart",data=utils.init({pluginId:utils.getQueryString("pluginId"),activeName:"overview",version:null,localPlugin:null,content:null,changeLog:null,isShouldUpdate:!1,cloudPlugin:null,cloudRelease:null,cloudUser:null}),methods={apiGet:function(){var l=this;$api.get($url,{params:{pluginId:this.pluginId}}).then(function(t){var i=t.data;l.version=i.version,l.localPlugin=i.localPlugin,l.content=i.content,l.changeLog=i.changeLog,cloud.getPlugin(l.pluginId,l.version).then(function(t){var i=t.data;l.cloudPlugin=i.plugin,l.cloudRelease=i.release,l.cloudUser=i.user,l.localPlugin&&(l.isShouldUpdate=-1==cloud.compareVersion(l.localPlugin.version,l.cloudRelease.version))}).catch(function(l){console.log(l)}).then(function(){utils.loading(l,!1)})}).catch(function(l){utils.error(l)})},apiDisable:function(l){var t=this;utils.loading(this,!0),$api.post($urlActionsDisable,{pluginId:l.pluginId,disabled:!l.disabled}).then(function(i){i.data;var n=l.disabled?"启用":"禁用";t.apiRestart(function(){utils.alertSuccess({title:"插件"+n+"成功",text:"插件"+n+"成功，系统需要重新加载",callback:function(){window.top.location.reload(!0)}})})}).catch(function(l){utils.error(l)}).then(function(){utils.loading(t,!1)})},apiDelete:function(l){var t=this;utils.loading(t,!0),$api.post($urlActionsDisable,{pluginId:l.pluginId,disabled:!0}).then(function(i){i.data;t.apiRestart(function(){$api.post($urlActionsDelete,{pluginId:l.pluginId}).then(function(l){t.apiRestart(function(){utils.alertSuccess({title:"插件卸载成功",text:"插件卸载成功，系统需要重载页面",callback:function(){window.top.location.reload(!0)}})})}).catch(function(l){utils.error(l)}).then(function(){utils.loading(t,!1)})})}).catch(function(l){utils.error(l)})},apiRestart:function(l){$api.post($urlActionsRestart).then(function(t){setTimeout(function(){l()},3e4)}).catch(function(l){utils.error(l)})},btnDisablePlugin:function(l){var t=this,i=l.disabled?"启用":"禁用";utils.alertDelete({title:i+"插件",text:"此操作将会"+i+"“"+l.displayName+"”，确认吗？",button:l.disabled?"确认启用":"确认禁用",callback:function(){t.apiDisable(l)}})},btnDeletePlugin:function(l){var t=this;utils.alertDelete({title:"卸载插件",text:"此操作将会卸载插件“"+l.displayName+"”，确认吗？",button:"确认卸载",callback:function(){t.apiDelete(l)}})},getPluginUrl:function(){return this.localPlugin&&this.localPlugin.homepage?this.localPlugin.homepage:cloud.getPluginsUrl("plugin.html?id="+this.pluginId)},getIconUrl:function(){return this.localPlugin?this.localPlugin.icon||utils.getAssetsUrl("images/favicon.png"):this.cloudPlugin?this.cloudPlugin.icon||utils.getAssetsUrl("images/favicon.png"):null},getTitle:function(){return this.localPlugin?this.localPlugin.displayName:this.cloudPlugin?this.cloudPlugin.title:null},getAuthor:function(){return this.localPlugin?this.localPlugin.publisher:this.cloudUser?this.cloudUser.userName:null},getVersion:function(){return this.localPlugin?this.localPlugin.version:this.cloudRelease?this.cloudRelease.version:null},getRepository:function(){return this.localPlugin?this.localPlugin.repository:this.cloudPlugin?this.cloudPlugin.projectUrl:null},getSummary:function(){return this.localPlugin?this.localPlugin.description:this.cloudPlugin?this.cloudPlugin.summary:null},getReadme:function(){return this.localPlugin?this.content:this.cloudPlugin?this.cloudPlugin.content:null},getChangeLog:function(){return this.localPlugin?this.changeLog:this.cloudPlugin?this.cloudPlugin.changeLog:null},getTagNames:function(l){var t=[];return l.tags&&(t=l.tags.split(",")),t}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){this.apiGet()}});